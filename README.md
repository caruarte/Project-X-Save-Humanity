# Project X: Save Humanity
#### Video Demo:  https://youtu.be/pmPIvXgs4Zs
#### Description:

This project is a game I created with Lua programming language and the LÃ–VE 2D framework, using the knowledge I gained through Colton Ogden's Games Track in CS50x 2020. The player is an astronaut who arrived to the moon to defend the Earth from a lot of aliens that threaten to attack it. The player has 3 lives and 5 bullets, with which he/she must go through each level and kill as many aliens and Red Knights (new enemies) as he/she can. However, if the player gets hit by an alien or a Red Knight's bullet, he/she loses one life. If the player loses all his/her lives, then game over. He/she can restart by pressing "Enter". Highest levels reached and most kills are saved until the player closes the game. There is no end in this game since each level is procedurally generated. Credits are given in the video.

#### **How I came up with the idea**
When I finished the games track, I wanted to make a game similar to the mario one shown in the track. I've always liked the sci-fi genre in retro games like *Space Invaders* so that's why I liked the idea of the game being located at a moon full of aliens, and the player being a NASA astronaut who has to "save the Earth".

#### ***fonts* folder**
In the *fonts* folder there are 2 fonts obtained from [DaFont](https://www.dafont.com/), which are used to write the scores (levels and kills) during the whole game, and to write the "*Press ENTER to start*" text in both the main menu and the game over screen.

#### ***graphics* folder**
All the images used in this game are inside the *graphics* folder. 
- The  *textures.png* image is the atlas of all the inanimate objects of the game; the moon, the planets, the space, the moon bases and the spaceship found only in level 1. It was all created in [Piskel](https://www.piskelapp.com/).
- The *Alien*, *Astronaut* and *RedKnight* png's are the corresponding spritesheets to all the animate and interactive objects of this game. They were all created in [Piskel](https://www.piskelapp.com/).
- The *bullet* and *heart* png's are the images of the usable items found around the map in each of the levels. The *heart* png is also used in the lives icons. They were both created in [Piskel](https://www.piskelapp.com/).
- The *Gun_UI* png is the transparent spritesheet of the gun UI shown during the game to indicate if the player is using the gun or not. It was created in [Piskel](https://www.piskelapp.com/).
- The *Project-X* and *Game-Over* png's correspond to the logo of the game found in the main menu and the "Game Over" image in the game over screen. Both images were made using [TextCraft](https://textcraft.net/). 
- The *book* and *mission_book* png's are both book images used to show the "How to Play" menu and the "Mission" menu (although this last menu's text is written using [*love.graphics.printf*](https://love2d.org/wiki/love.graphics.printf)). They were edited using [Pixlr](https://pixlr.com/).
- All the other images are buttons and their respectives "hovering" states, used in the main menu and the game over screen. They were made using [Piskel](https://www.piskelapp.com/), [TextCraft](https://textcraft.net/), and [Pixlr](https://pixlr.com/).

#### ***sounds* folder**
All the sound effects and music used throughout the game.
- *Video Game Land* and *Sky Loop* are both loopable songs taken out from [Freesound](https://freesound.org/), used in the main menu, game over screen and in-game.
- *ui-click*, *reload*, *footsteps*, *use-gun* and *ui-hover* are sound effects taken out from [Freesound](https://freesound.org/), used in the player's actions and buttons.
- The rest of the audios are sound effects generated in [Bfxr](https://www.bfxr.net/), used for player's behaviours and events.

#### **Alien.lua**
This file contains the ***Alien*** class which is used by one of the two enemies in the game that attack the player. They spawn at a random position around the map but increase in number as you go through each level. Aliens move fast but only to the right or left, changing their sprite in a loop to create the appearance of walking. They cannot jump or do anything apart from walking until they hit a block or there's no floor in front of them. In that case, they change their direction. If they are in a position where they can't move anywhere, they stay at that position. The player loses one life if an alien hits him. However, if one of the player's bullets hits an alien, it makes a *kill* sound, stops walking and starts a non-loopable animation of "dying". When the animation ends, the alien is deleted from the "aliens" table.
Aliens are inspired by *Goombas* from Nintendo's Mario franchise.

#### **Animation.lua**
This file contains the ***Animation*** class which is used in all the moving objects in the game, to loop through a spritesheet at a specified interval speed and generate a moving appearance. It's like the mario one made during the games track, but I added a "loop" parameter. If it is *true*, the animation will loop back and forth forever until it is told to stop. An example of this type of animation could be the "walking" animation of the player. However, if it is set to *false*, then the animation will only occur once, without a loop. An example of this type of animation could be the "dying" animation of the aliens or Red Knights.

#### **Bullet.lua**
This file contains the ***Bullet*** class which is used in the bullets created after the player or a Red Knight shoots. At first, I put each bullet as lists (with x, y and dx) inside a bigger table which contained all bullets. These lists were the same in both the player and the Red Knights, with the only difference being that the player's were created by clicking while the Red Knights' were created after a certain interval, and the player's had to harm the aliens and the Red Knights while the Red Knights' had to harm the player. The *update* part of the bullets was really long and repetitive (it was full of loops and conditionals to check for each object it had to harm) so I decided to make a different file containing a specific *Bullet* class, that took as parameters the object from which the bullet came from, the map it was in, the width and height of the bullet, and a list of objects that the bullet had to harm. In this way, each bullet has its own target to check every frame (which is much more tidy in my opinion), the player's and Red Knights' codes don't repeat that much, and the *update* part of bullets are now as simple as going through a list of all the bullets and *telling them to update*. Each bullet takes the initial *x*, *y* and *direction* of its parent object, from which it starts its trajectory. The bullet has a static *dx* depending of the direction on its parent object, causing it to move to the right or left. Depending on the *hittable* parameter, the bullet checks every frame if it is hitting the objects inside it. If it hits its target object, it causes them to make the *kill* sound and die (if it is an alien or Red Knight) or lose a life and make the *hit* sound (if it is the player). After this, the bullet is deleted from the "bullets" table in the parent object. They are also deleted if they reach the end of the map or they hit a collidable tile.

#### **BulletIcon.lua**
This file contains the ***BulletIcon*** class which is used in the bullet items dispersed randomly all around the map, on the floor. If the player picks up a bullet item (by walking over it), he/she gets one more bullet to use against his/her enemies. However, the maximum amount of bullets that the player can have is 5, so if he/she tries to get more, the bullet item will not have effect. The bullet item disappears after the player picks it. They also have a nice animation that makes them look more like "objects that can be picked up".

#### **Button.lua**
This file contains the ***Button*** class which is used in all buttons inside the main menu and game over screen. It has *x* and *y* parameters to indicate the location of the button, an *img* parameter to get the image or images (in a table) that the button will use, a *scale* parameter to scale the button's image, and a *multiple* parameter that can be *true* or *false* depending on whether the button is going to use multiple images or not. When the cursor is on top of the button (*hover* attribute is true), it plays a *hover* sound and changes its image to a hover state (if *multiple* is true). It also has a *pressed* attribute that is set to *true* whenever it receives external input from the mouse that it has been clicked (if *hover* is true and the mouse has been clicked then the *pressed* attribute is set to *true*). In that moment, a *click* sound is played and something opens or closes.

#### **class.lua**
This file is a ***class*** library by Matthias Richter that allowed this game to use object-oriented programming in a simple approach. Thank you Matthias!

#### **GameOver.lua**
This file contains the ***GameOver*** class which is used in the game over screen. It has a background of a sky full of stars, like the ones used in-game, a small game's logo, and huge text saying "GAME OVER". It has a *music* attribute that stores the song *Sky Loop* which is looped during the time the player is in the game over screen.
It has a "Menu" button that returns the user to the main menu if it is clicked. When the user clicks on it, it makes a *clicking* sound.
The game over screen also shows the level reached and kills in the current game, and the highest level reached and most kills since the game has been opened. If the user presses *Enter*, he/she restarts the game.

#### **HeartIcon.lua**
This file contains the ***HeartIcon*** class which is used in the Heart items dispersed randomly all around the map, on the floor. If the player picks up a heart item (by walking over it), he/she gets one more live to use if one of his/her enemies attacks him/her. However, the maximum amount of lives that the player can have is 3, so if he/she tries to get more, the heart item will not have effect. The heart item disappears after the player picks it. They also have a nice animation that makes them look more like "objects that can be picked up".

#### **main.lua**
This file is the ***main*** lua file in this game. Here the fonts are set, the window title is written, the window is set to fullscreen, the used cursors are selected, and the push library is used to change the game's resolution. The gameOver and menu objects are created, and the starting game state is set to be the menu one. All keys pressed are recorded in a table. If the user presses "Escape", the game closes. If the user presses "Enter", the game state changes to the *play* one and the *map* object is created. Mouse clicks are sent to functions inside other objects. The camera in the *play* state is translated according to the player. Each object (menu, map and game over) updates and renders depending on the game state.

#### **Map.lua**
This file contains the ***Map*** class which is used in the map created during the game. The *map* object is created when the "Enter" key is pressed during the main menu or the game over screen. The mouse pointer disappears when this happens. It takes the *game over* screen as a parameter so that it compares the current scores with the highest scores achieved throughout different games. The map has a texture atlas named *textures.png* that is chopped into squares of 16x16 pixels to create the tiles that are going to be used in the map. They are stored in a *tileSprites* attribute, a table with indexes. It also has a *music* attribute that stores the song *Video Game Land* which is going to be looped during the game. Later, the map has as attributes the initial amount of aliens and Red Knights, the Red Knights' appearance level, the initial amount of heart an bullet items on the floor, the camera's x and y, the lives and gun UI sprites, and the current level and kills.

The map has a *start()* function that is called every time a level is generated. It takes in the initial map width (in tiles) of the map, as a parameter.  This parameter is only given at the start of the game (when "Enter" is pressed), which sets the level to *1* and all alien, Red Knight and item counts to their initial values. The map width is resetted to its initial value of *30 tiles*. However, every time the player goes to the next level, this function is called without any parameters. In this case the level, map width and alien count increase. If the level is equal to *10*, Red Knights appear with their start count; but if the level is greater than *10*, then the Red Knight count increases. If the level is divisible by 5, then one more heart and bullet items appear on the floor. The gun UI on the top right corner of the screen changes depending on whether the player uses the gun or not.
All levels have a sky full of stars, the moon as floor and a moon base at the end of each level to go to the next one. However, only in level 1 the player is going to start from a space ship; in the next levels he/she is going to start from a moon base. Also, I wanted to give the sky a less-boring aspect. That's why in each level planets are going to appear in a random point at the sky. In level 1, only *Mercury* will appear, but every 5 levels a new planet will appear until level 35, where the last planet will appear, *Neptune*.
Every time the function is called, each planet has a *drawn* state that sets to true when they get drawn into the screen, so that the same planet is not drawn twice.

The terrain of each level is procedurally generated, that means that it is *"randomly"* generated. Since the level is generated in columns, I used that to set the start elevation of the terrain to 0. After each column, the map randomly chooses to go one tile up (elevation of the terrain changing to 1), to stay at the same tile elevation (elevation of the terrain staying at 0), or to go one tile down (elevation of the terrain changing to -1). This happens again and again until the map ends, creating a different terrain every time a level is generated. This is the part of the project that I'm most proud of.

After all the terrain generation, all the enemies and items are created in a random position around the map, always over a moon tile. And after all of that, the player is generated at the start of the level.

The map has some functions like *setTile()*, which sets tiles in a table with a number, *getTile()*, which returns the tile in specific tile x and y, and *tileAt()*, which returns the tile in specific x and y coordinates. There's also a *collides()* function returns gets a tile and returns true or false depending on whether it is collidable or not.

The map is in charge of updating and rendering every element in the map: the player, his/her enemies, the items on the floor, the bullets each object shoots, the lives and gun UI, the current level and kills, and the camera. The camera moves in all directions along with the UI, according to how the player moves, but it stops when the map's limits are reached.

When the player dies, the *gameEnd()* function is called, which changes the screen to the "game over" one, changes the music theme being played, sets the mouse cursor to be visible again, and updates the highest scores (levels and kills) if corresponding.

#### **Menu.lua**
This file contains the ***Menu*** class which is used in the main menu. It has a background of a sky full of stars, like the ones used in-game, and a logo in the middle with the game's title (it moves up and down to give it a retro aspect). It has a *music* attribute that stores the song *Sky Loop* which is going is looped during the time the player is in the menu.

It has 3 buttons:
- Exit Button: If the user clicks on it, the game closes.
- How to Play Button: If the user clicks on it, a book with the game's instructions will appear. It has an internal *cancel* button that returns the user to the main menu if he/she clicks on it.
- Mission Button: If the user clicks on it, a book with some text will appear. This text is a kind of  introduction to the game or *story* that tells the user what they have to do in this game. It has an internal *cancel* button that returns the user to the main menu if he/she clicks on it.
When the user clicks on a button, it makes a *clicking* sound.

The main menu also shows the highest level reached and most kills since the game has been opened. If the user presses *Enter*, he/she goes into the game.

#### **Player.lua**
This file contains the ***Player*** class which is used by the main character in this game, Dr. Hart, an astronaut sent to the moon by the NASA to defend the Earth. He can walk with keys *A* and *D*, making a *walking* sound; jump (using a jetpack) with the *spacebar*, making a *jumping* sound; and shoot with *left click*, making a *laser* sound that is similar to the Red Knights'. To shoot, he must use the gun first with the *E* key so that the gun UI on the top right is activated. However, if the astronaut uses the gun, he walks slower and jumps lower, so the player must alternate between both modes to be more efficient. The astronaut can kill aliens and Red Knights by shooting at them, gaining 1 kill each. The astronaut is also affected by gravity so he will go down if he is in the air.
The astronaut has 3 lives and 5 bullets. If he gets hit by an alien or by a Red Knight's bullet, he will lose one life, play a *hit* sound, and will enter in an immune state for 2 seconds where he can't lose any life. The astronaut will start disappearing and appearing again during this state. If the astronaut shoots, he loses 1 bullet. However, if the astronaut picks up one *heart* item (goes over it), he gets one life. If the astronaut picks up one *bullet* item (goes over it), he gets one bullet. The maximum amount of lives and bullets are 3 and 5 respectively, so if the player tries to get more, the heart and bullet items will not have effect. If the player goes through the moon base entrance, he enters to the next level. The astronaut can't shoot if he doesn't have bullets and if he loses all lives, then the map changes into a game over screen.

#### **push.lua**
This file is a library made by Ulysse Ramage that creates a virtual raster that you can draw to, which gets stretched to fill whatever window size that you want. This makes it easier to program games in a lower resolution to create the appearance of a retro game.

#### **RedKnight.lua**
This file contains the ***RedKnight*** class which is used by the second one of the 2 enemies in this game that attack the player. They spawn at a random position around the map since level 10 but increase in number as the player goes through each level. Red Knights move slowly and only to the right or left, changing their sprite in a loop to create the appearance of walking. They cannot jump like the aliens but unlike them, Red Knights can shoot to the direction they are pointing at that moment. They have infinite bullets and shoot every 2 seconds, automatically, making a *laser* sound like the player's. They walk until they hit a block or there's no floor in front of them. In that case, they change their direction. If they are in a position where they can't move anywhere, they stay at that position and keep shooting. The player loses one life if a Red Knights hit him/her with one of their bullets. The player does not lose any life if he/she touches a Red Knight physically, only their bullets make damage. However, if any of the player's bullets hits Red Knights, they make a *kill* sound, stop walking and start a non-loopable animation of "dying". This animation varies depending on the direction from which the Red Knight was shot. When the animation ends, the Red Knight is deleted from the "redKnights" table.
Red Knights are based on the astronaut's design, with red space suits and cloaks. They are pirates of the universe, traitors to humanity, that's why they must be killed alongside aliens.

#### **Util.lua**
This file is a ***utility*** library that contains a function called *generateQuads()*, which is used in all the game to chop textures and spritesheets in a specific width and height. All these chopped parts are stored into a table called *quads* that is indexed. This can be useful for animation purposes or for chopping an atlas.